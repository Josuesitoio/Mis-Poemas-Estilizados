<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Espejo Fragmentado</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Tema Oscuro (por defecto) */
            --bg-color: #0d1117;
            --text-color: #e0e0e0;
            --highlight-gradient: linear-gradient(90deg, #e0e0e0, #ffffff, #b0b0b0, #ffffff, #e0e0e0);
            --crystal-base-color: rgba(200, 220, 255, 0.05); /* Muy sutil */
            --crystal-shine-color: rgba(255, 255, 255, 0.15);
            --crystal-border-color: rgba(255, 255, 255, 0.1);
            
            --font-serif: 'Cormorant Garamond', serif;
            --font-sans: 'Inter', sans-serif;
            --transition-speed: 0.5s;
        }
        
        body.light-mode {
             /* Tema Claro */
            --bg-color: #f0f4f8;
            --text-color: #333333;
            --highlight-gradient: linear-gradient(90deg, #4a5568, #2d3748, #718096, #2d3748, #4a5568);
            --crystal-base-color: rgba(100, 150, 200, 0.1);
            --crystal-shine-color: rgba(0, 0, 0, 0.1);
            --crystal-border-color: rgba(0, 0, 0, 0.08);
        }

        html { scroll-behavior: smooth; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-sans);
            margin: 0;
            overflow-x: hidden;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        /*
        ==================================================
        --- FONDO: CRISTAL DINÁMICO QUE SE FRAGMENTA ---
        ==================================================
        * Un elemento grande simula el cristal inicial.
        * Más abajo, se generan fragmentos dinámicos.
        */
        #crystal-background {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        #main-crystal {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, var(--crystal-shine-color) 0%, transparent 80%);
            border: 1px solid var(--crystal-border-color);
            transition: opacity 1s ease-out;
        }

        .crystal-fragment {
            position: absolute;
            background: var(--crystal-base-color);
            border: 1px solid var(--crystal-border-color);
            backdrop-filter: blur(2px); /* Un ligero blur para el efecto de cristal */
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 1s ease-out, transform 1s ease-out;
            will-change: transform, opacity;
            z-index: 0; /* Asegurar que esté por debajo del contenido */
        }
        
        .crystal-fragment.active {
            opacity: 1;
            transform: scale(1);
        }

        /* Formas para los fragmentos */
        .shape1 { clip-path: polygon(0% 15%, 15% 0%, 100% 50%, 85% 100%, 20% 90%); }
        .shape2 { clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%); }
        .shape3 { clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%); }
        .shape4 { clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); }

        main, header {
            position: relative;
            z-index: 1;
            /* Se añade un fondo transparente al contenido para mejor lectura sobre el cristal */
            background-color: rgba(0, 0, 0, 0.4); 
            transition: background-color var(--transition-speed);
        }
        body.light-mode main, body.light-mode header {
            background-color: rgba(255, 255, 255, 0.6);
        }

        .page-header {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .page-header h1 {
            font-family: var(--font-serif);
            font-size: 4rem;
            font-weight: 700;
            color: var(--text-color); /* Cambiado a text-color para coherencia con el tema */
            letter-spacing: 2px;
            animation: text-glow 4s infinite alternate;
        }

        @keyframes text-glow {
            from { text-shadow: 0 0 10px rgba(255,255,255,0.4); }
            to { text-shadow: 0 0 20px rgba(255,255,255,0.8); }
        }
        body.light-mode @keyframes text-glow {
            from { text-shadow: 0 0 10px rgba(0,0,0,0.2); }
            to { text-shadow: 0 0 20px rgba(0,0,0,0.4); }
        }

        #poema-museo {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 10vh 0;
        }
        
        .estrofa {
            max-width: 700px;
            padding: 2rem;
            margin-bottom: 20vh; /* Espaciado entre estrofas */
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 1s cubic-bezier(0.19, 1, 0.22, 1), transform 1s cubic-bezier(0.19, 1, 0.22, 1);
        }
        
        .estrofa.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .estrofa p {
            font-size: 1.6rem;
            line-height: 1.8;
            margin: 0.5rem 0;
            font-weight: 300;
        }
        
        .highlight {
            font-family: var(--font-serif);
            font-weight: 700;
            font-style: italic;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            background-image: var(--highlight-gradient);
            background-size: 200% 100%;
            animation: shimmer-text 5s infinite linear;
            transition: background-image var(--transition-speed);
        }
        
        @keyframes shimmer-text {
            from { background-position: 200% 0; }
            to { background-position: 0 0; }
        }
        
        #theme-toggle {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            background: rgba(128, 128, 128, 0.1);
            border: 1px solid rgba(128, 128, 128, 0.2);
            border-radius: 50%; width: 45px; height: 45px;
            cursor: pointer; display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(5px); transition: all 0.3s;
        }
        #theme-toggle:hover { transform: scale(1.1); }
        #theme-toggle svg {
            width: 24px; height: 24px; color: var(--text-color);
            position: absolute; transition: opacity 0.3s, transform 0.3s;
        }
        #sun-icon { opacity: 0; }
        body.light-mode #sun-icon { opacity: 1; }
        body.light-mode #moon-icon { opacity: 0; }

        @media (max-width: 768px) {
            .page-header h1 { font-size: 2.8rem; }
            .estrofa { padding: 1rem; margin-bottom: 15vh; }
            .estrofa p { font-size: 1.3rem; }
            main, header { background-color: rgba(0, 0, 0, 0.6); } /* Más opaco en móvil */
            body.light-mode main, body.light-mode header { background-color: rgba(255, 255, 255, 0.8); }
        }
    </style>
</head>
<body>
    <button id="theme-toggle" title="Cambiar tema">
        <svg id="moon-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2A9.91 9.91 0 0 0 9 2.46A10 10 0 0 1 9 21.54A9.91 9.91 0 0 0 12 22A10 10 0 0 0 12 2Z"></path></svg>
        <svg id="sun-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8M12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,12.5H23V11.5H20V12.5M1,12.5H4V11.5H1V12.5M12.5,20V23H11.5V20H12.5M12.5,1V4H11.5V1H12.5M18.36,19.78L20.5,21.92L19.78,22.63L17.65,20.5L18.36,19.78M4.22,6.34L6.35,4.22L5.64,3.5L3.5,5.64L4.22,6.34M19.78,5.64L17.65,3.5L18.36,4.22L20.5,6.34L19.78,5.64M3.5,18.36L5.64,17.65L6.34,19.78L4.22,20.5L3.5,18.36Z"></path></svg>
    </button>

    <div id="crystal-background">
        <div id="main-crystal"></div>
    </div>

    <header class="page-header">
        <h1>El Espejo Fragmentado</h1>
    </header>

    <main id="poema-museo">
        <section class="estrofa">
            <p>En el <span class="highlight">valle del olvido</span></p>
            <p>Vi <span class="highlight">tu rostro.</span></p>
            <p>Qué curioso -pense-</p>
            <p>¿Quién es esa <span class="highlight">bella, pero cortada mujer?</span></p>
        </section>
        <section class="estrofa">
            <p>Luce hermosa,</p>
            <p>aunque tiene <span class="highlight">cristales incrustados</span></p>
            <p>en todo su rostro.</p>
        </section>
        <section class="estrofa">
            <p>Hey! -grité-</p>
            <p>Pero al voltear,</p>
            <p><span class="highlight">mi reflejo</span> bailaba en cada cristal,</p>
            <p>como perro tras su propia sombra</p>
            <p>Corrí y pude ver</p>
            <p>que en esos <span class="highlight">espejos</span> aparecía ella.</p>
        </section>
        <section class="estrofa">
            <p>-¿Quién eres? -pregunto, ingenuo.-</p>
            <p>-<span class="highlight">Soy quien te rompió</span> -respondió-</p>
        </section>
        <section class="estrofa">
            <p>A mi parecer, <span class="highlight">rota estaba ella;</span></p>
            <p>pues aunque brillante se veía,</p>
            <p>no entendía</p>
            <p>que <span class="highlight">brillaba por algo que reflejaba en ella,</span></p>
            <p><span class="highlight">y jamás por ella misma.</span></p>
        </section>
        <section class="estrofa">
            <p>Qué extraña es la luz -pensé-</p>
            <p>que <span class="highlight">ciega y arrastra.</span></p>
        </section>
        <section class="estrofa">
            <p>Ese <span class="highlight">rostro cortado, con pedazos de cristal, desmoronándose</span>,</p>
            <p>en el <span class="highlight">valle del olvido</span>,</p>
            <p>debería quedarse allí…</p>
            <p>¿Pero por qué me atrae esa desconocida?</p>
        </section>
        <section class="estrofa">
            <p>-<span class="highlight">Te amo</span> -me dijo-</p>
            <p>pero, ¿cómo puedes amar si rota estás?</p>
            <p>Acaso me dirás que a amar aprendiste,</p>
            <p>pero que soltar no pudiste.</p>
        </section>
        <section class="estrofa">
            <p>Pues aunque amarte quiero,</p>
            <p>mi <span class="highlight">ego roto</span> me dice que no puedo,</p>
            <p>y mi <span class="highlight">orgullo grita</span> que no te escuche.</p>
        </section>
        <section class="estrofa">
            <p>Pues aunque <span class="highlight">abrazarte me cortaría,</span></p>
            <p>mi corazón apartarse de ti no quería.</p>
            <p>Se aferra como <span class="highlight">pez en anzuelo</span></p>
            <p>a nuestro <span class="highlight">último recuerdo.</span></p>
            <p>Que aunque vagando se encuentre,</p>
            <p>tú y yo sabemos</p>
            <p>que <span class="highlight">amor aún nos queda…</span></p>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const crystalBackground = document.getElementById('crystal-background');
            const mainCrystal = document.getElementById('main-crystal');
            const estrofas = document.querySelectorAll('.estrofa');

            // --- LÓGICA DEL INTERRUPTOR DE TEMA ---
            const themeToggle = document.getElementById('theme-toggle');
            if (localStorage.getItem('theme') === 'light') {
                body.classList.add('light-mode');
            }
            themeToggle.addEventListener('click', () => {
                body.classList.toggle('light-mode');
                localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
            });

            // --- OBSERVADOR PARA LA APARICIÓN DE ESTROFAS Y FRAGMENTACIÓN DEL CRISTAL ---
            const estrofaObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        
                        // Generar fragmentos cuando la estrofa es visible
                        const rect = entry.target.getBoundingClientRect();
                        const scrollY = window.scrollY || window.pageYOffset;
                        const triggerPoint = rect.top + scrollY + rect.height / 2; // Centro de la estrofa

                        if (triggerPoint > window.innerHeight * 0.5) { // Empieza a fragmentar después de la mitad de la primera vista
                            generateFragments(triggerPoint);
                        }
                    }
                });
            }, { 
                threshold: 0.2, // Activa cuando el 20% de la estrofa es visible
                rootMargin: "0px 0px -10% 0px"
            });
            estrofas.forEach(estrofa => estrofaObserver.observe(estrofa));

            // --- LÓGICA DE FRAGMENTACIÓN DINÁMICA ---
            const SHAPE_CLASSES = ['shape1', 'shape2', 'shape3', 'shape4'];
            let lastFragmentY = 0; // Para evitar superposición excesiva
            let fragmentCount = 0; // Para limitar la cantidad de fragmentos

            function generateFragments(yPosition) {
                if (fragmentCount > 50) return; // Limitar fragmentos para rendimiento

                const numFragments = Math.random() * 3 + 1; // 1 a 3 fragmentos por estrofa
                for (let i = 0; i < numFragments; i++) {
                    const fragment = document.createElement('div');
                    fragment.className = `crystal-fragment ${SHAPE_CLASSES[Math.floor(Math.random() * SHAPE_CLASSES.length)]}`;

                    const size = Math.random() * 100 + 50; // Tamaño de 50px a 150px
                    const top = yPosition + (Math.random() * 100 - 50) - (window.innerHeight * 0.5); // Relativo al scroll y centro
                    const left = Math.random() * 100; // Porcentaje de ancho

                    fragment.style.width = `${size}px`;
                    fragment.style.height = `${size}px`;
                    fragment.style.top = `${top}px`;
                    fragment.style.left = `${left}%`;
                    fragment.style.transform = `scale(${Math.random() * 0.5 + 0.7}) rotate(${Math.random() * 360}deg)`; // Escala y rotación aleatoria

                    crystalBackground.appendChild(fragment);

                    // Pequeño retraso para la animación de aparición
                    setTimeout(() => fragment.classList.add('active'), 50);
                    fragmentCount++;
                }
            }

            // Ocultar el cristal principal a medida que se desplaza hacia abajo
            window.addEventListener('scroll', () => {
                const scrollY = window.scrollY || window.pageYOffset;
                const opacity = Math.max(0, 1 - (scrollY / (window.innerHeight * 2))); // Desaparece en 2 vh de scroll
                mainCrystal.style.opacity = opacity;
            }, { passive: true });
        });
    </script>
</body>
</html>
