<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CULPA — Poema Griego</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Merriweather:wght@300;400;700&family=Cormorant+Garamond:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #10141D;
      --accent: #D4AF37;
      --panel: rgba(12, 16, 26, 0.25); /* Más transparente */
      --text: #EAE3D9;
      --muted: rgba(234, 227, 217, 0.7);
      --border-color: rgba(212, 175, 55, 0.15);
      --max-width: 780px;
      --transition: 300ms cubic-bezier(.2,.9,.3,1);
      --glass-blur: 10px;
      --focus-ring: rgba(212, 175, 55, 0.4);
    }
    body.light-theme{
      --bg: #F8F3E9;
      --accent: #3E6E9B;
      --panel: rgba(255, 255, 255, 0.35); /* Más transparente */
      --text: #2C353C;
      --muted: rgba(44, 53, 60, 0.75);
      --border-color: rgba(62, 110, 155, 0.12);
      --focus-ring: rgba(62, 110, 155, 0.4);
    }
    *{box-sizing:border-box}
    html,body{height:auto}
    body{
      margin:0;
      font-family: "Merriweather", serif;
      background-color:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.7;
      min-height:100vh;
      transition: background-color var(--transition), color var(--transition);
    }
    .background-layers{
      position:fixed;
      inset:0;
      z-index:-3;
      background-color:var(--bg);
      background-image:
        radial-gradient(ellipse at 50% 100%, rgba(var(--accent-rgb), 0.08) 0%, transparent 70%),
        radial-gradient(ellipse at 10% 20%, rgba(var(--text-rgb), 0.03) 0%, transparent 50%);
      background-size: cover;
      overflow:hidden;
      animation: bgFadeIn 2s ease-out forwards, nebulaMove 60s ease-in-out infinite alternate;
      filter: blur(2px);
    }
    @keyframes bgFadeIn {
        from { opacity: 0.5; }
        to { opacity: 1; }
    }
    @keyframes nebulaMove {
        0% { transform: scale(1) translate(0,0); }
        50% { transform: scale(1.05) translate(5%,-5%); }
        100% { transform: scale(1) translate(0,0); }
    }
    body.light-theme .background-layers {
        background-image:
            radial-gradient(ellipse at 50% 100%, rgba(var(--accent-rgb), 0.1) 0%, transparent 70%),
            radial-gradient(ellipse at 10% 20%, rgba(var(--text-rgb), 0.05) 0%, transparent 50%);
    }
    #particle-canvas {
      position: fixed;
      inset: 0;
      z-index: -2;
      pointer-events: none;
    }
    .page{
      width:100%;
      padding:48px 20px;
      display:flex;
      flex-direction: column;
      align-items:center;
      justify-content:flex-start;
      min-height:100vh;
    }
    .container{
      width:100%;
      max-width:calc(var(--max-width) + 56px);
      margin:0 auto;
      position:relative;
      padding:28px;
      display:flex;
      flex-direction:column;
      gap:24px;
      align-items:center;
    }
    header.site-header{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      position:relative;
      padding-top: 20px;
    }
    .title{
      font-family: "Playfair Display", serif;
      font-size:clamp(1.5rem, 3vw, 2.2rem);
      letter-spacing:4px;
      text-transform:uppercase;
      color:var(--accent);
      text-shadow: 0 1px 2px rgba(0,0,0,0.4);
      padding:6px 14px;
      display:inline-block;
      opacity:0;
      transform:translateY(10px);
      animation: titleIn 900ms ease forwards;
    }
    @keyframes titleIn{ to{opacity:1; transform:none} }
    .controls{
      position:absolute;
      right:0;
      top:50%;
      transform: translateY(-50%);
      display:flex;
      gap:8px;
      align-items:center;
    }
    .control-btn{
      background:transparent;
      border:1px solid transparent;
      color:var(--muted);
      padding:8px;
      border-radius:50%;
      cursor:pointer;
      transition: all var(--transition);
      display:inline-flex;
      align-items:center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }
    .control-btn:focus-visible{
      outline:none;
      box-shadow:0 0 0 3px var(--focus-ring);
      color: var(--accent);
    }
    .control-btn:hover{
        transform:translateY(-2px);
        color: var(--text);
        background-color: rgba(255,255,255,0.08);
    }
    body.light-theme .control-btn:hover {
        background-color: rgba(0,0,0,0.05);
    }
    .poem-panel{
      width:100%;
      max-width:var(--max-width);
      background: var(--panel);
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      border-radius:12px;
      padding:clamp(30px, 6vw, 56px);
      box-shadow: 0 10px 45px rgba(0,0,0,0.55), inset 0 1px 0 rgba(255,255,255,0.07);
      border:1px solid rgba(255,255,255,0.1);
      position:relative;
      transition: transform var(--transition), box-shadow var(--transition);
      margin-bottom: 40px;
    }
    body.light-theme .poem-panel {
        box-shadow: 0 10px 35px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.25);
        border:1px solid rgba(0,0,0,0.08);
    }
    .poem-inner{
      max-width:calc(var(--max-width) - 80px);
      margin:0 auto;
      position:relative;
    }
    .poem-inner .byline{
      font-family:"Cormorant Garamond", serif;
      font-size:clamp(0.9rem, 1.5vw, 1.05rem);
      color:var(--muted);
      margin-bottom:10px;
      letter-spacing:0.8px;
      text-align: center;
      transition: color var(--transition);
    }
    .poem-inner .poem-title{
      font-family:"Playfair Display", serif;
      text-transform:uppercase;
      letter-spacing:4px;
      color:var(--accent);
      margin-bottom:20px;
      font-size:clamp(1.1rem, 2vw, 1.4rem);
      text-align: center;
      opacity:0;
      transform:translateY(10px);
      animation: poemTitleIn 900ms ease forwards 300ms;
      transition: color var(--transition);
    }
    @keyframes poemTitleIn { to{opacity:1; transform:none} }
    .stanza{
      margin:2.5em 0;
      opacity:0;
      transform:translateY(20px);
      transition:opacity 700ms ease-out, transform 700ms ease-out;
      text-align: justify;
    }
    .stanza.revealed{ opacity:1; transform:none; }
    .stanza p{
      margin:0.8em 0;
      font-size:clamp(1rem, 1.8vw, 1.15rem);
      line-height:1.8;
      color:var(--text);
      text-wrap:balance;
      hyphens:auto;
      letter-spacing: 0.2px;
      transition: color var(--transition);
    }
    .stanza p.dialog{
      color:var(--muted);
      font-style: italic;
      padding-left: 1em;
      border-left: 2px solid var(--accent);
    }
    .stanza .highlight {
        color: var(--accent);
        font-weight: 700;
        transition: color var(--transition);
    }
    dialog#infoDialog {
        background: var(--panel);
        color: var(--text);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 30px;
        width: 90%;
        max-width: 550px;
        box-shadow: 0 10px 50px rgba(0,0,0,0.4);
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
        transition: background var(--transition), color var(--transition), border-color var(--transition);
    }
    dialog#infoDialog::backdrop {
        background-color: rgba(0,0,0,0.6);
        backdrop-filter: blur(6px);
    }
    dialog#infoDialog h4 {
        font-family:"Playfair Display", serif;
        color: var(--accent);
        margin: 0 0 15px 0;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-size: clamp(1.2rem, 2vw, 1.4rem);
        text-align: center;
        transition: color var(--transition);
    }
    dialog#infoDialog p {
        font-family: "Cormorant Garamond", serif;
        font-size: clamp(1rem, 1.5vw, 1.1rem);
        margin: 0 0 25px 0;
        line-height: 1.6;
        transition: color var(--transition);
    }
    .dialog-close-btn {
        background: var(--accent);
        color: var(--bg);
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-family: "Playfair Display", serif;
        font-size: 1.1rem;
        letter-spacing: 1px;
        display: block;
        margin: 0 auto;
        transition: background-color var(--transition), color var(--transition), transform 200ms ease;
    }
    .dialog-close-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    @media print{
      body, .stanza p, .poem-inner .byline, .poem-inner .poem-title { background:white !important; color:black !important; }
      .background-layers, #particle-canvas, header, dialog { display:none !important; }
      .poem-panel{box-shadow:none !important; background:transparent !important; border:none !important; padding:0 !important; }
      .poem-inner{max-width:100% !important; margin:0 !important; padding:0 !important;}
      .stanza p{font-size:12pt; line-height:1.6;}
      .stanza .highlight { color: inherit !important; font-weight: normal !important; }
    }
    @media (max-width:700px){
      .controls { position: static; transform: none; margin-top: 20px; }
      .poem-panel{padding:28px}
      .container{padding:18px}
    }
    @media (prefers-reduced-motion: reduce){
      .stanza, .title, .poem-title { animation: none !important; transition: none !important; opacity: 1; transform:none !important; }
      #particle-canvas { display: none; }
    }
  </style>
</head>
<body class="night-theme">
  <div class="background-layers" aria-hidden="true"></div>
  <canvas id="particle-canvas" aria-hidden="true"></canvas>
  <div class="page" role="main">
    <div class="container" id="container">

      <header class="site-header" role="banner">
        <h1 class="title" id="pageTitle">CULPA</h1>
        <div class="controls" role="toolbar" aria-label="Controles">
          <button class="control-btn" id="themeToggle" aria-label="Alternar modo claro y oscuro">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          </button>
          <button class="control-btn" id="infoToggle" aria-label="Mostrar información del poema">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          </button>
          <button class="control-btn" id="printBtn" aria-label="Imprimir poema">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
          </button>
        </div>
      </header>

      <article class="poem-panel" role="article" aria-labelledby="pageTitle">
        <div class="poem-inner">
          <section class="poem" id="poem" aria-label="Poema 'CULPA'">
            <div class="stanza" data-index="0">
              <p>Me siguen sombras con <span class="highlight">ojos de sangre</span>, no vienen de afuera: nacieron en mí.</p>
              <p>Sus látigos no azotan la carne, sino el <span class="highlight">recuerdo que nunca muere</span>.</p>
            </div>
            <div class="stanza" data-index="1">
              <p>Hoy la vi, y no como creí. Su tan extraño rostro me atraía</p>
              <p>y, aunque creía que todo bien estaría, no entendía lo que sucedía.</p>
            </div>
            <div class="stanza" data-index="2">
              <p class="dialog">—Oye... —susurró en mi oído—</p>
              <p>Algo no entendía, pues esa sensación yo ya la conocía.</p>
            </div>
            <div class="stanza" data-index="3">
              <p class="dialog">—¡Déjame! —dije enojado—</p>
              <p>Y por más que yo corría, su voz no desaparecía.</p>
              <p>Quién diría que hasta en mis sueños me perseguiría.</p>
            </div>
            <div class="stanza" data-index="4">
              <p>Una sombra se aferraba a mi espalda.</p>
              <p class="dialog">—¿Por qué me soltaste? —sentí en su respiro—</p>
              <p>Y fue extraño reconocer <span class="highlight">esa voz</span>. Esa voz imposible, hecha de <span class="highlight">ecos y olvido</span>.</p>
            </div>
            <div class="stanza" data-index="5">
              <p>Me habitó el <span class="highlight">miedo</span>, el pavor de un imperio que se derrumba por dentro.</p>
              <p>Y no era mi cuerpo el que temblaba, sino mi <span class="highlight">alma en ruinas</span>.</p>
            </div>
            <div class="stanza" data-index="6">
              <p>En el oleaje de mi mente, las ideas rompían como olas incesantes.</p>
              <p>Y su estruendo no cesaba de acusarme: “Pudiste haber <span class="highlight">hecho más</span>”.</p>
            </div>
            <div class="stanza" data-index="7">
              <p>Y el mundo se encoge hasta ser este teatro donde soy actor sin público. O casi...</p>
              <p>Pues en la butaca oscura solo estamos yo y aquello que me habita:</p>
              <p>esa <span class="highlight">sombra con dientes de rata</span> que se alimenta de mi acto,</p>
              <p>que me consume en esta última escena.</p>
            </div>
            <div class="stanza" data-index="8">
              <p>Y en el silencio de la sala suena un <span class="highlight">disco rayado</span>. Siempre es la misma canción.</p>
              <p>Un himno a lo único que me queda, al único espectador.</p>
              <p>Su melodía es el compás de los dientes de la rata, la aguja que graba surcos en mi cerebro hasta que solo existe ese sonido, ese <span class="highlight">lamento que me recuerda que estoy, irremediablemente, solo</span>.</p>
            </div>
            <div class="stanza" data-index="9">
              <p class="dialog">—Oye... ¿me escuchas?</p>
            </div>
            <div class="stanza" data-index="10">
              <p class="dialog">—¿Quién eres? —pregunté, cual esclavo de quien me atormenta—</p>
            </div>
            <div class="stanza" data-index="11">
              <p class="dialog">—Soy Erinias. Mejor conocida como <span class="highlight">Culpa</span>.</p>
            </div>
            <div class="stanza" data-index="12">
              <p>Y en ese nombre, Erinias, lo comprendí todo.</p>
              <p>No había un monstruo persiguiéndome en la oscuridad.</p>
              <p>No era una criatura nacida del infierno, sino la <span class="highlight">furia engendrada en mis propios actos</span>.</p>
              <p>Y entendí que no se puede huir de quien bebe de la sangre de tus propias heridas.</p>
            </div>
            <div class="stanza" data-index="13">
              <p>El esclavo, al fin, conocía a su ama: <span class="highlight">La memoria</span>. y la culpa, traicionera,</p>
              <p>hiere a quienes nunca debió tocar, y a quienes realmente la merecen,</p>
              <p>parece que les da tregua. Es un <span class="highlight">látigo invisible que no entiende justicia</span>,</p>
              <p>solo <span class="highlight">recuerda y condena</span>.</p>
            </div>
          </section>
        </div>
      </article>

    </div>
  </div>

  <dialog id="infoDialog">
    <h4>Sobre el Poema</h4>
    <p>Las Erinias, en la mitología griega, son las personificaciones femeninas de la venganza. Perseguían a los culpables de ciertos crímenes hasta volverlos locos. Este poema explora cómo la culpa actúa como una Erinia moderna, una sombra nacida de nuestros propios actos.</p>
    <button id="closeInfoBtn" class="dialog-close-btn">Entendido</button>
  </dialog>

  <script>
    (function(){
      const body = document.body;
      const themeToggle = document.getElementById('themeToggle');
      const infoToggle = document.getElementById('infoToggle');
      const printBtn = document.getElementById('printBtn');
      const infoDialog = document.getElementById('infoDialog');
      const closeInfoBtn = document.getElementById('closeInfoBtn');
      let particles = [];
      let nebulas = []; // Array para las nebulosas
      let animationFrameId;

      function hexToRgb(hex) {
          if (!hex || typeof hex !== 'string' || hex.length !== 7) return '0,0,0';
          return `${parseInt(hex.slice(1,3),16)},${parseInt(hex.slice(3,5),16)},${parseInt(hex.slice(5,7),16)}`;
      }

      function updateCssVars() {
          const styles = getComputedStyle(document.documentElement);
          const accentHex = styles.getPropertyValue('--accent').trim();
          const textHex = styles.getPropertyValue('--text').trim();
          document.documentElement.style.setProperty('--accent-rgb', hexToRgb(accentHex));
          document.documentElement.style.setProperty('--text-rgb', hexToRgb(textHex));
      }

      const savedTheme = localStorage.getItem('poem_theme');
      if (savedTheme === 'light') { body.classList.add('light-theme'); }
      updateCssVars();

      themeToggle.addEventListener('click', () => {
        body.classList.toggle('light-theme');
        localStorage.setItem('poem_theme', body.classList.contains('light-theme') ? 'light' : 'dark');
        updateCssVars();
        // Forzar actualización de colores en partículas y nebulosas
        particles.forEach(p => p.updateColor());
        nebulas.forEach(n => n.updateColor());
      });

      infoToggle.addEventListener('click', () => { infoDialog.showModal(); });
      closeInfoBtn.addEventListener('click', () => { infoDialog.close(); });
      infoDialog.addEventListener('click', (e) => { if (e.target === infoDialog) infoDialog.close(); });
      printBtn.addEventListener('click', () => window.print());

      const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if (!prefersReduced) {
        const stanzas = Array.from(document.querySelectorAll('.stanza'));
        if ('IntersectionObserver' in window) {
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const el = entry.target;
                setTimeout(() => el.classList.add('revealed'), (parseInt(el.dataset.index || 0, 10) % 5) * 100);
                observer.unobserve(el);
              }
            });
          }, { threshold: 0.1 });
          stanzas.forEach(s => observer.observe(s));
        }

        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');

        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.layer = Math.floor(Math.random() * 3); // 0: back, 1: middle, 2: front
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height + canvas.height;
                this.vx = (Math.random() - 0.5) * (0.2 + this.layer * 0.2);
                this.vy = -(Math.random() * 1 + 0.5 + this.layer * 0.5);
                this.radius = 0.5 + this.layer * 0.5 + Math.random();
                this.alpha = Math.random() * 0.3 + 0.1 + this.layer * 0.1;
                this.twinkleSpeed = Math.random() * 0.03 + 0.005;
                this.isShootingStar = this.layer > 0 && Math.random() < 0.02; // Más estrellas fugaces (2%)
                if (this.isShootingStar) {
                    this.radius = Math.random() * 2 + 2; // Más grande
                    this.vy *= 4; // Más rápida
                    this.alpha = Math.random() * 0.5 + 0.5; // Más brillante
                }
                this.updateColor();
            }
            updateColor() { this.colorRgb = hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--accent').trim()); }
            draw() {
                const currentAlpha = this.alpha * (0.6 + Math.abs(Math.sin(Date.now() * this.twinkleSpeed)));
                ctx.beginPath();
                if (this.isShootingStar) {
                    const trailLength = 30 + this.layer * 10; // Cola más larga para estrellas fugaces
                    const gradient = ctx.createLinearGradient(this.x, this.y, this.x - this.vx * trailLength, this.y - this.vy * trailLength);
                    gradient.addColorStop(0, `rgba(${this.colorRgb}, ${currentAlpha})`);
                    gradient.addColorStop(0.8, `rgba(${this.colorRgb}, ${currentAlpha * 0.5})`); // Cola más brillante al inicio
                    gradient.addColorStop(1, `rgba(${this.colorRgb}, 0)`);
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = this.radius;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                } else {
                    ctx.fillStyle = `rgba(${this.colorRgb}, ${currentAlpha})`;
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                if(this.y < -this.radius*20 || this.x < -this.radius*20 || this.x > canvas.width + this.radius*20) { this.reset(); }
            }
        }

        class Nebula {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height + canvas.height * 2; // Empiezan muy abajo
                this.size = Math.random() * 100 + 100; // Tamaño grande
                this.speed = Math.random() * 0.05 + 0.02; // Muy lenta
                this.alpha = Math.random() * 0.05 + 0.02; // Muy transparente
                this.oscillation = Math.random() * Math.PI * 2; // Para movimiento de vaivén
                this.oscillationSpeed = Math.random() * 0.005 + 0.001;
                this.rotation = Math.random() * Math.PI * 2; // Rotación
                this.rotationSpeed = Math.random() * 0.0005 + 0.0001;
                this.updateColor();
            }
            updateColor() { this.colorRgb = hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--accent').trim()); }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                const currentAlpha = this.alpha * (0.8 + Math.sin(Date.now() * this.oscillationSpeed) * 0.2); // Pulsación de opacidad
                ctx.fillStyle = `rgba(${this.colorRgb}, ${currentAlpha})`;
                ctx.filter = 'blur(20px)'; // Efecto de blur en el canvas
                ctx.beginPath();
                ctx.ellipse(0, 0, this.size * 1.2, this.size * 0.8, 0, 0, Math.PI * 2); // Forma elíptica
                ctx.fill();
                ctx.filter = 'none'; // Resetear blur para otras cosas
                ctx.restore();
            }
            update() {
                this.y -= this.speed;
                this.x += Math.sin(this.oscillation) * 0.1;
                this.oscillation += this.oscillationSpeed;
                this.rotation += this.rotationSpeed;
                if(this.y < -this.size) { this.reset(); }
            }
        }

        function setupCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            nebulas = [];

            const particleCount = Math.floor((canvas.width * canvas.height) / 5000); // Más partículas
            for(let i = 0; i < particleCount; i++) { particles.push(new Particle()); }

            const nebulaCount = Math.floor((canvas.width * canvas.height) / 100000); // Algunas nebulosas
            for(let i = 0; i < nebulaCount; i++) { nebulas.push(new Nebula()); }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Dibujar nebulosas primero (capa más profunda)
            nebulas.forEach(n => { n.update(); n.draw(); });
            // Luego las partículas
            particles.forEach(p => { p.update(); p.draw(); });
            animationFrameId = requestAnimationFrame(animate);
        }

        function startAnimation() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            setupCanvas();
            animate();
        }
        startAnimation();
        window.addEventListener('resize', startAnimation);
      }
    })();
  </script>
</body>
</html>