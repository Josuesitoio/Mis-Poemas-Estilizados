<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuan conciente es un hilo</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans+Mono:wght@300;400&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">

    <style>
        /*
        ============================================
        --- CONFIGURACI√ìN DE TEMA Y VARIABLES ---
        ============================================
        * Se definen los colores para ambos modos (claro y oscuro).
        * El color del hilo se mantiene rojo y brillante en ambos.
        */
        :root {
            /* Tema Oscuro (por defecto) */
            --bg-color: #1a1818;
            --text-color: #9e9e9e;
            --heading-color: #ffffff;
            --thread-color: #ff3b30;
            --thread-glow: rgba(255, 59, 48, 0.5);
            
            --font-sans: 'Spline Sans Mono', monospace;
            --font-serif: 'Playfair Display', serif;
            --transition-speed: 0.5s;
        }

        body.light-mode {
            /* Tema Claro */
            --bg-color: #f5f2ed;
            --text-color: #4a4a4a;
            --heading-color: #000000;
        }

        /*
        ============================================
        --- ESTILOS GENERALES Y DEL CUERPO ---
        ============================================
        * El fondo es un canvas limpio para que los hilos destaquen.
        * Se oculta el desbordamiento para controlar el layout.
        */
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-sans);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        /*
        ============================================
        --- ESTRUCTURA PRINCIPAL Y LIENZO ---
        ============================================
        * El 'canvas' es el contenedor principal que permite el posicionamiento
          absoluto de los hilos y el texto, creando un diorama.
        * La altura se calcula en JS para abarcar todo el contenido.
        */
        .canvas {
            position: relative;
            width: 100%;
            margin: 0 auto;
        }

        /*
        ============================================
        --- ESTILOS DE LOS HILOS (SVG) ---
        ============================================
        * Los hilos est√°n presentes desde el inicio.
        * Tienen una animaci√≥n sutil para que se sientan "vivos".
        * El filtro drop-shadow crea el efecto de brillo.
        */
        .thread {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .thread path {
            stroke: var(--thread-color);
            fill: none;
            filter: drop-shadow(0 0 5px var(--thread-glow));
            transition: stroke var(--transition-speed), filter var(--transition-speed);
            animation: breathe 8s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { stroke-width: 2.5; }
            50% { stroke-width: 3.5; }
        }

        /* Capas de hilos para crear profundidad y el efecto de tejido */
        #background-thread { z-index: 1; opacity: 0.4; }
        #midground-thread { z-index: 3; }
        #foreground-thread { z-index: 5; } /* La capa m√°s alta para pasar sobre el texto */

        /*
        ============================================
        --- ESTILOS DEL TEXTO Y ESTROFAS ---
        ============================================
        * Las estrofas se posicionan de forma absoluta en el lienzo.
        * Cada palabra est√° en un 'span' para animaciones escalonadas.
        * El z-index del texto es 4, permitiendo que los hilos
          pasen por encima (z-index: 5) y por debajo (z-index: 1, 3).
        */
        .estrofa {
            position: absolute;
            width: 400px; /* Ancho base para el texto */
            z-index: 4;
        }

        .estrofa p {
            font-size: 1.3rem;
            line-height: 1.9;
            margin: 0;
            /* Se necesita para que los spans internos no se desborden durante la animaci√≥n */
            display: block;
            -webkit-font-smoothing: antialiased;
        }
        
        .estrofa p .word {
            display: inline-block;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.8s, transform 0.8s;
            transition-timing-function: cubic-bezier(0.19, 1, 0.22, 1);
        }

        .estrofa.visible p .word {
            opacity: 1;
            transform: translateY(0);
        }

        .highlight {
            font-family: var(--font-serif);
            font-style: italic;
            color: var(--heading-color);
        }

        .thread-voice {
            font-family: var(--font-serif);
            font-weight: 700;
            color: var(--thread-color);
            text-shadow: 0 0 8px var(--thread-glow);
        }

        /* Posicionamiento espec√≠fico de cada estrofa en el lienzo */
        #estrofa-1 { top: 15vh; left: 15vw; }
        #estrofa-2 { top: 60vh; left: 55vw; text-align: right; }
        #estrofa-3 { top: 110vh; left: 10vw; }
        #estrofa-4 { top: 160vh; left: 50vw; text-align: right; }
        #estrofa-5 { top: 210vh; left: 18vw; }
        #estrofa-6 { top: 250vh; left: 45vw; text-align: right; }

        /*
        ============================================
        --- ANIMACIONES ESPECIALES ---
        ============================================
        */
        @keyframes tug-animation {
            0%, 100% { transform: translate(0, 0); }
            10%, 50%, 90% { transform: translate(-3px, 1px) rotate(-0.5deg); }
            30%, 70% { transform: translate(3px, -1px) rotate(0.5deg); }
        }
        .is-tugging {
            animation: tug-animation 0.6s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        #pendulum-container {
            position: absolute;
            width: 100px;
            height: 100px;
            z-index: 3;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #pendulum-container.visible { opacity: 1; }
        #pendulum-thread {
            stroke: var(--thread-color);
            stroke-width: 2.5;
            fill: none;
            filter: drop-shadow(0 0 5px var(--thread-glow));
            transform-origin: 50% 0;
            animation: swing 3.5s infinite ease-in-out;
        }
        @keyframes swing {
            0%, 100% { transform: rotate(25deg); }
            50% { transform: rotate(-25deg); }
        }
        
        /*
        ============================================
        --- PART√çCULAS ---
        ============================================
        */
        #particles-container {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 6; pointer-events: none;
        }
        .particle {
            position: absolute;
            width: 3px; height: 3px;
            background-color: var(--thread-color);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--thread-glow);
            animation: float-away 3s ease-out forwards;
        }
        @keyframes float-away {
            from { transform: scale(1); opacity: 0.8; }
            to { transform: translate(var(--x-end), var(--y-end)) scale(0); opacity: 0; }
        }

        /*
        ============================================
        --- INTERRUPTOR DE TEMA Y RESPONSIVIDAD ---
        ============================================
        */
        #theme-toggle {
            position: fixed; top: 20px; right: 20px; z-index: 1000; font-size: 1.5rem;
            background: transparent; border: none; cursor: pointer; transition: transform 0.3s;
        }
        #theme-toggle:hover { transform: scale(1.2); }
        #sun-icon { display: none; }
        body.dark-mode #sun-icon { display: block; }
        body.dark-mode #moon-icon { display: none; }

        @media (max-width: 768px) {
            .estrofa {
                width: 80vw;
                left: 10vw !important; /* Forzar alineaci√≥n a la izquierda */
                text-align: left !important;
                margin-bottom: 20vh;
            }
            .estrofa p { font-size: 1.1rem; }
            
            #estrofa-1 { top: 10vh; }
            #estrofa-2 { top: 50vh; }
            #estrofa-3 { top: 85vh; }
            #estrofa-4 { top: 125vh; }
            #estrofa-5 { top: 160vh; }
            #estrofa-6 { top: 190vh; }
        }
    </style>
</head>
<body>

    <button id="theme-toggle" title="Cambiar tema">
        <span id="moon-icon">üåô</span>
        <span id="sun-icon">‚òÄÔ∏è</span>
    </button>
    
    <div class="canvas" id="main-canvas">
        <div id="particles-container"></div>
    
        <svg id="background-thread" class="thread" viewBox="0 0 1400 3000" preserveAspectRatio="xMidYMin slice">
            <path d="M 100,0 C 400,200 800,100 1300,400 S 1000,800 600,900 S 100,1200 500,1400 S 1200,1600 1300,1800 S 800,2200 400,2400 S 200,2800 700,3000" />
        </svg>

        <svg id="midground-thread" class="thread" viewBox="0 0 1400 3000" preserveAspectRatio="xMidYMin slice">
            <path id="main-thread-path" d="M 300,0 C 0,300 500,400 700,600 S 900,800 1300,900 S 1000,1300 700,1500 S 400,1700 200,1900 S 600,2300 900,2500 S 1300,2800 1100,3000" />
        </svg>

        <svg id="foreground-thread" class="thread" viewBox="0 0 1400 3000" preserveAspectRatio="xMidYMin slice">
            <path d="M 250,150 C 350,180 450,180 550,150" />
            <path d="M 950,490 C 1050,520 1150,520 1250,490" />
            <path d="M 150,1150 C 250,1180 350,1180 450,1150" />
            <path d="M 1100,1700 C 1000,1670 900,1670 800,1700" />
            <path d="M 850,2650 C 950,2680 1050,2680 1150,2650" />
        </svg>
        
        <div id="pendulum-container">
            <svg width="100" height="100"><path id="pendulum-thread" d="M 50,0 V 80" /></svg>
        </div>

        <div id="estrofa-1" class="estrofa">
            <p>No te extra√±o</p>
            <p>Dije, me dije</p>
            <p>Incr√©dulo,</p>
            <p>Y con la direcci√≥n de un <span class="highlight" id="pendulum-trigger">p√©ndulo.</span></p>
        </div>
        
        <div id="estrofa-2" class="estrofa">
            <p id="tug-trigger">Hoy tiraste, jalaste</p>
            <p>De aquel hilo que nos atamos</p>
            <p>Sent√≠, sentiste, sentimos...</p>
        </div>

        <div id="estrofa-3" class="estrofa">
            <p>Tiraste de mis ideas</p>
            <p>Tiraste de mis pensamientos</p>
            <p>Y yo cu√°l <span class="highlight">alma errante</span></p>
            <p>Que busca una caricia</p>
            <p>Te cre√≠</p>
        </div>

        <div id="estrofa-4" class="estrofa">
            <p>A√∫n con dolor te ame,</p>
            <p><span class="thread-voice">No como me amaste</span></p>
            <p><span class="thread-voice">Yo no amo tan poco</span></p>
            <p><span class="thread-voice">Dijo el hilo rojo.</span></p>
        </div>
        
        <div id="estrofa-5" class="estrofa">
            <p>Me asust√©...</p>
            <p>Pero curioso pregunt√©</p>
            <p>¬øA qu√© te refieres?</p>
        </div>

        <div id="estrofa-6" class="estrofa">
            <p><span class="thread-voice">El contesto, ella jam√°s ato aquel nudo</span></p>
            <p><span class="thread-voice">Siempre fuiste tu...</span></p>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const mainCanvas = document.getElementById('main-canvas');

            // --- AJUSTAR ALTURA DEL LIENZO AL CONTENIDO ---
            // Se usa un peque√±o retraso para asegurar que todas las fuentes y elementos se hayan renderizado
            setTimeout(() => {
                const contentHeight = mainCanvas.scrollHeight;
                mainCanvas.style.height = `${contentHeight}px`;
                document.querySelectorAll('.thread').forEach(svg => {
                    svg.setAttribute('height', contentHeight);
                });
            }, 100);


            // --- L√ìGICA DEL INTERRUPTOR DE TEMA ---
            const themeToggle = document.getElementById('theme-toggle');
            if (localStorage.getItem('theme') === 'light') { body.classList.add('light-mode'); }
            themeToggle.addEventListener('click', () => {
                body.classList.toggle('light-mode');
                localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
            });
            
            // --- FUNCI√ìN CORREGIDA PARA ENVOLVER PALABRAS EN SPANS ---
            document.querySelectorAll('.estrofa p').forEach(p => {
                const spans = [];
                // 1. Reemplazar spans existentes con placeholders y guardarlos
                let tempContent = p.innerHTML.replace(/<span.*?<\/span>/g, (match) => {
                    spans.push(match);
                    return `%%SPAN_${spans.length - 1}%%`;
                });

                // 2. Envolver el texto restante (que ahora es seguro) en spans de palabras
                const wrappedContent = tempContent.split(/(\s+)/).filter(Boolean).map(part => {
                    if (part.includes('%%SPAN_') || part.trim() === '') {
                        return part;
                    }
                    return `<span class="word">${part}</span>`;
                }).join('');

                // 3. Reinsertar los spans originales en lugar de los placeholders
                p.innerHTML = wrappedContent.replace(/%%SPAN_(\d+)%%/g, (match, index) => {
                    return spans[parseInt(index, 10)];
                });
            });

            // --- L√ìGICA DE PART√çCULAS ---
            const particlesContainer = document.getElementById('particles-container');
            const mainThreadPath = document.getElementById('main-thread-path');
            if (mainThreadPath) {
                const pathLength = mainThreadPath.getTotalLength();
                
                function createParticle() {
                    const pointOnThread = mainThreadPath.getPointAtLength(Math.random() * pathLength);
                    
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = `${pointOnThread.x}px`;
                    particle.style.top = `${pointOnThread.y}px`;
                    
                    particle.style.setProperty('--x-end', `${(Math.random() - 0.5) * 100}px`);
                    particle.style.setProperty('--y-end', `${(Math.random() - 0.5) * 100 - 30}px`);

                    particlesContainer.appendChild(particle);
                    setTimeout(() => particle.remove(), 3000);
                }
                setInterval(createParticle, 150);
            }

            // --- OBSERVADOR PARA ESTROFAS Y ANIMACIONES ESPECIALES ---
            const pendulumContainer = document.getElementById('pendulum-container');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const target = entry.target;
                        
                        if (target.classList.contains('estrofa')) {
                            target.classList.add('visible');
                            const words = target.querySelectorAll('.word');
                            words.forEach((word, index) => {
                                word.style.transitionDelay = `${index * 50}ms`;
                            });
                        }
                        
                        if (target.id === 'pendulum-trigger') {
                            pendulumContainer.classList.add('visible');
                            const rect = target.getBoundingClientRect();
                            pendulumContainer.style.top = `${rect.top + window.scrollY}px`;
                            pendulumContainer.style.left = `${rect.left + (rect.width / 2) - 50}px`;
                        }

                        if (target.id === 'tug-trigger') {
                           target.parentElement.classList.add('is-tugging');
                           setTimeout(() => target.parentElement.classList.remove('is-tugging'), 600);
                        }
                    } else {
                        if (entry.target.id === 'pendulum-trigger') {
                           pendulumContainer.classList.remove('visible');
                        }
                    }
                });
            }, { threshold: 0.2 });

            document.querySelectorAll('.estrofa, #pendulum-trigger, #tug-trigger').forEach(el => observer.observe(el));
        });
    </script>
</body>
</html>